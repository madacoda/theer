generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model User {
  id               Int        @id @default(autoincrement())
  uuid             String     @unique @default(uuid())
  name             String
  email            String     @unique
  password         String
  created_at       DateTime   @default(now())
  updated_at       DateTime   @updatedAt
  created_tickets  Ticket[]   @relation("CreatedTickets")
  resolved_tickets Ticket[]   @relation("ResolvedTickets")
  roles            UserRole[]

  @@map("users")
}

model Role {
  id          Int        @id @default(autoincrement())
  uuid        String     @unique @default(uuid())
  name        String
  description String?
  users       UserRole[]

  @@map("roles")
}

model UserRole {
  id         Int      @id @default(autoincrement())
  uuid       String   @unique @default(uuid())
  user_id    Int
  role_id    Int
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt
  role       Role     @relation(fields: [role_id], references: [id])
  user       User     @relation(fields: [user_id], references: [id])

  @@unique([user_id, role_id])
  @@map("user_roles")
}

model TicketCategory {
  id          Int      @id @default(autoincrement())
  uuid        String   @unique @default(uuid())
  title       String
  description String?
  created_at  DateTime @default(now())
  updated_at  DateTime @updatedAt
  tickets     Ticket[]

  @@map("ticket_categories")
}

model Ticket {
  id              Int             @id @default(autoincrement())
  uuid            String          @unique @default(uuid())
  category_id     Int?
  title           String
  content         String?
  status          String          @default("open")
  sentiment_score Float?
  urgency         String?
  ai_draft        String?
  ai_metadata     Json?
  created_by_id   Int?
  resolved_by_id  Int?
  resolved_at     DateTime?
  created_at      DateTime        @default(now())
  updated_at      DateTime        @updatedAt
  category        TicketCategory? @relation(fields: [category_id], references: [id])
  created_by      User?           @relation("CreatedTickets", fields: [created_by_id], references: [id])
  resolved_by     User?           @relation("ResolvedTickets", fields: [resolved_by_id], references: [id])

  @@map("tickets")
}
